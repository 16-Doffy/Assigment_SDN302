<% /* product, feedbacks, myFeedback are passed from router */ %>
<h1 class="text-2xl font-bold mb-4"><%= product.name %></h1>

<div class="mb-6">
  <p><%= product.description %></p>
  <p class="font-bold text-pink-600">$<%= (product.price || 0).toFixed(2) %></p>
</div>

<h2 class="text-xl font-semibold mb-2">Feedbacks</h2>
<% if (feedbacks.length === 0) { %>
  <p>No feedback yet.</p>
<% } else { %>
  <ul>
    <% feedbacks.forEach(f => { %>
      <li class="border p-3 mb-2">
        <div class="text-sm text-gray-700"><strong><%= f.member && (f.member.fullname || f.member.username) %></strong> â€” <small><%= new Date(f.createdAt).toLocaleString() %></small></div>
        <div class="mt-1"><%= f.comment %></div>
        <div class="text-yellow-600">Rating: <%= f.rating %>/5</div>
      </li>
    <% }) %>
  </ul>
<% } %>

<% if (user) { %>
  <h3 class="mt-6">Your feedback</h3>
  <form method="post" action="/products/<%= product._id %>/feedback">
    <div class="mb-2">
      <label for="rating">Rating</label>
      <select name="rating" id="rating">
        <% for (let r=5;r>=1;r--) { %>
          <option value="<%= r %>" <%= myFeedback && myFeedback.rating===r ? 'selected' : '' %>><%= r %></option>
        <% } %>
      </select>
    </div>
    <div class="mb-2">
      <textarea name="comment" rows="4" required class="w-full border p-2"><%= myFeedback ? myFeedback.comment : '' %></textarea>
    </div>
    <button class="btn btn-primary" type="submit">Save feedback</button>
  </form>
<% } else { %>
  <p><a href="/auth/signin">Sign in</a> to leave feedback.</p>
<% } %>


